<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 折腾折腾家庭网络架构 · LUOYE</title><meta name="description" content="折腾折腾家庭网络架构 - Luoye"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="https://s10.mogucdn.com/mlcdn/c45406/181108_569k3hlic06fcbj3i96b426i024d9.ico"><link rel="stylesheet" href="/blog/css/apollo.css"><link rel="stylesheet" href="/blog/css/prism.css"></head><body><div class="wrap"><header><a href="/blog/" class="logo-link"><img src="https://s10.mogucdn.com/mlcdn/c45406/180104_87747584h81ji8hjc144bkgkgk9ai_460x460.jpg"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="https://luoyefe.com" target="_blank" class="nav-list-link">INDEX</a></li><li class="nav-list-item"><a href="/blog/archives/" target="_self" class="nav-list-link">ARCHIVES</a></li><li class="nav-list-item"><a href="https://www.zhihu.com/people/luo-ye-42-22" target="_blank" class="nav-list-link">ZHIHU</a></li><li class="nav-list-item"><a href="https://github.com/luoye-fe" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">折腾折腾家庭网络架构</h1><div class="post-info">2020年12月18日</div><div class="post-content"><h2 id="先上图"><a href="#先上图" class="headerlink" title="先上图"></a>先上图</h2><blockquote>
<p>全屏，放大，看细节</p>
</blockquote>
<p><img src="./1607846697398-cbedba69-c3d7-4b34-94ef-3271b8d86f6c.svg" alt></p>
<h2 id="来吧，展示"><a href="#来吧，展示" class="headerlink" title="来吧，展示"></a>来吧，展示</h2><ul>
<li><p>聚阅：<a href="http://render.luoyefe.com/juyue" target="_blank" rel="noopener">http://render.luoyefe.com/juyue</a></p>
</li>
<li><p>goh5：太老，不展示了</p>
</li>
<li><p>喝水提醒：非节假日早九到晚九提醒喝水</p>
<p><img src="./1607846816545-fa7b5336-3a9c-47cb-afee-741356479b5f.png" alt="image.png"></p>
</li>
<li><p>plex：家庭影音、照片等媒体资源管理工具</p>
<p><img src="./1607846937467-f3d2f69d-1db5-422e-9dbc-ef59b9bcd578.png" alt="image.png"></p>
<p><img src="./1607847007968-e76c73aa-dd35-4e03-b34f-55fcaf2a70a9.png" alt="image.png"></p>
</li>
<li><p>Nginx：端口转发，反代内网服务，允许外网通过域名的 80/443 端口访问内网服务</p>
<p><img src="./1607847173948-57c3a835-11a3-445b-9ac8-b925a0091125.png" alt="image.png"></p>
</li>
<li><p>Portaniner: Docker 容器管理</p>
<p><img src="./1607847297365-a82aa362-15a3-4ca5-ba75-b680e4b48461.png" alt="image.png"></p>
</li>
</ul>
<h2 id="细节"><a href="#细节" class="headerlink" title="细节"></a>细节</h2><h3 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h3><p>域名备案不复杂，阿里云现在的备案流程大概一个星期即可</p>
<h3 id="SSL-证书"><a href="#SSL-证书" class="headerlink" title="SSL 证书"></a>SSL 证书</h3><ul>
<li><p>各云厂商免费的证书（需一年重新生成一次，麻烦）</p>
</li>
<li><p><a href="https://cheapsslsecurity.com/" target="_blank" rel="noopener">https://cheapsslsecurity.com/</a> 按需购买全球最便宜的 SSL 证书</p>
</li>
</ul>
<h3 id="VPS"><a href="#VPS" class="headerlink" title="VPS"></a>VPS</h3><p>推荐度从上到下</p>
<ul>
<li>各厂商的新手服务器</li>
<li>阿里云国际版机器</li>
<li>阿里云</li>
</ul>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><p>云厂商负载均衡产品或者自建 nginx，我是买了一台 1H0.5G 的超低配 ECS 自建 nginx。</p>
<h3 id="软路由"><a href="#软路由" class="headerlink" title="软路由"></a>软路由</h3><p>路由分硬路由和软路由，硬路由就是传统路由器，tplink、华硕、网件等等，常用功能完备，但是性能较弱，溢价较高，可玩性太低。</p>
<p>如果你爱折腾，并且希望家庭内网免工具科学上网、无广告，并且联网设备较多，并且带宽高于100M（小水管就放弃吧），快上软路由！</p>
<p>软路由其实就是一台多网口的服务器，你可以选择 厂商准系统 &gt; 自建 &gt; NUC 工控机 &gt; 老电脑 + pcie 多网口网卡。</p>
<p>软路由系统，openwrt/lede 都试试，找个你喜欢的。</p>
<p>科学上网，自己摸索吧~</p>
<p>去广告，软路由系统都带。</p>
<h3 id="交换机"><a href="#交换机" class="headerlink" title="交换机"></a>交换机</h3><p>千兆POE交换机。</p>
<h3 id="AP"><a href="#AP" class="headerlink" title="AP"></a>AP</h3><p>装修的时候，吊顶走一根网线！！！AP直接吸顶放在全家中央，哪里都是信号满格，没到多层别墅或者大平层的兄弟不要折腾无线漫游，坑死。</p>
<h3 id="NAS（重点！！！）"><a href="#NAS（重点！！！）" class="headerlink" title="NAS（重点！！！）"></a>NAS（重点！！！）</h3><h4 id="NAS-选购"><a href="#NAS-选购" class="headerlink" title="NAS 选购"></a>NAS 选购</h4><ul>
<li>您有钱嘛？-&gt; 群晖</li>
<li>性价比高，不喜欢折腾？-&gt; 威联通</li>
<li>轻量使用（无影音解码、无挂机下载、无远程桌面） -&gt; 树莓派、成品 NUC 工控机</li>
<li>常规使用（低功耗、高性能、大容量）-&gt; 自建（后叙详情）</li>
<li>重度使用 -&gt; 2U服务器 + 机架（芜湖起飞，没涉及的领域，大佬走好）</li>
</ul>
<p><strong>常规使用自建NAS：</strong></p>
<blockquote>
<p>总则：低功耗、高性能、大容量，具体硬件型号就不推荐了额~</p>
</blockquote>
<ul>
<li>CPU：别选AMD，TDP太高，稳定性堪忧；选新不选旧，10100 比 8100 强了何止2代的差距；</li>
<li>主板：sata 口 &gt;= 6；支持所选U的入门款；</li>
<li>内存：需要虚拟化 windows 的话至少 16G，其他 8G 足够</li>
<li>硬盘：单盘越大越好；5400转速，噪音低；</li>
<li>显卡：CPU 集显已经足够硬解2k视频，如需要更高的 gpu 能力可以加</li>
<li>其他：电源、散热、机箱看着办吧</li>
</ul>
<h4 id="NAS-数据"><a href="#NAS-数据" class="headerlink" title="NAS 数据"></a>NAS 数据</h4><p>家庭使用不推荐任何阵列！！！</p>
<p>阵列对硬盘要求很高，长时间的恢复过程有大量的读写，极有可能对硬盘造成二次伤害，阵列卡同理。</p>
<p>最推荐的做法，<strong>重要数据定时、定条件冷备。**</strong>非要阵列可以选选择 snapraid，需要一块容量大于任意一块数据盘的校验盘，恢复数据时，只用唤醒校验盘，不会对其他数据盘造成二次伤害。</p>
<h4 id="NAS-系统"><a href="#NAS-系统" class="headerlink" title="NAS 系统"></a>NAS 系统</h4><p>太多了，freenas、unraid、unas、openmediavault 等等，但是如果你有基本的服务器知识，推荐使用原生 linux 系统。大部分的 nas 系统只是提供了一套UI外加数据池、阵列等能力，却带来了很多非标 linux 的问题，深入使用发生问题难以排查，所以我选择 debian 作为 nas 系统。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><ul>
<li><p><strong>家庭宽带怎么获取公网IP？</strong></p>
<p>电话宽带服务商，将光猫改为桥接模式，自行在路由器上拨号，即可获取公网IP。</p>
</li>
<li><p><strong>实在没有公网IP怎么办？</strong></p>
<p>在有公网IP的 vps 上部署 frp 内网穿透服务，使用 frp 访问家庭内网</p>
</li>
<li><p><strong>家庭带宽要多大？怎么办最便宜？</strong></p>
<p>提速降费说了这么多年了，百兆时代该过去了，千兆你好（现在精装的新房已经超六类网线，支持万兆网速）。</p>
<p>办宽带？上闲鱼！千兆电信只要999！</p>
</li>
<li><p><strong>外网如何不带端口号，直接通过域名访问内网服务？</strong></p>
<ul>
<li>通过 DDNS，把域名（比如 *.home.example.com）解析到家内的公网 IP </li>
<li>此时路由器做端口转发，通过 xx.home.example.com:port 已经可以访问内网服务</li>
<li>公网 nginx 代理 <em>.route.example.com 到 </em>.home.example.com 的开放端口（比如 10080）</li>
<li>路由器转发开放端口（比如 10080）到内网 nginx 服务端口（比如 80）</li>
<li>内网 nginx 反代具体域名到相应端口，比如 xx.route.example.com 到 192.168.1.111:8080</li>
<li>此时通过 xx.route.example.com 可以直接访问内网服务</li>
</ul>
<p>相当于在内网的 nginx 做 dns 解析服务，把 <em>.route.example.com 的 </em>，具体解析到 xx</p>
</li>
</ul>
</div></article></div></section><footer><div class="paginator"><a href="/blog/2021/02/05/一维码、二维码的生成原理/" class="prev">上一篇</a><a href="/blog/2020/12/18/NPM-的基础知识/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'luoyefe';
var disqus_identifier = '2020/12/18/折腾折腾家庭网络架构/';
var disqus_title = '折腾折腾家庭网络架构';
var disqus_url = 'https://luoyefe.com/blog/2020/12/18/折腾折腾家庭网络架构/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//luoyefe.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2021 <a href="https://luoyefe.com/blog">Luoye</a>, unless otherwise noted.</p></div></footer></div><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-78104533-1",'auto');ga('send','pageview');
var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "https://hm.baidu.com/hm.js?213cc17b8240ff47d16b1b3aa9dbe0ad";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="/blog/js/prism.js"></script></body></html>